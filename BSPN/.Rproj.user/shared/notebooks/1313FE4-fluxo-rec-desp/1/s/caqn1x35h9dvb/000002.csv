"0","rec <- read_excel(""dados/Sankey Receitas por Fonte.xlsx"", skip = 10)"
"0","des <- read_excel(""dados/Sankey Despesas por Fonte.xlsx"", skip = 10)"
"0","names(rec) <- c(""nr"", ""fte"", ""fte_nome"", ""rec"")"
"0","names(des) <- c(""fte"", ""fte_nome"", ""nd"", ""des"")"
"0","rec <- rec %>%"
"0","  group_by(nr) %>%"
"0","  mutate(rec = rec,  #/1000000"
"0","         subtot_rec = sum(rec),"
"0","         per_rec_fte = rec/sum(rec)) # calcula os % de distrib. de cada rec nas ftes"
"0","des <- des %>%"
"0","  group_by(fte) %>%"
"0","  mutate(des = des, #/1000000"
"0","         per_fte_des = des/sum(des)) # calcula os % de distrib. de fte nas desps"
"0","matriz <- rec %>%"
"0","  full_join(des)"
"0","# calcula o % de dist. de cada rec nas desps"
"0","# calcula então o tamanho de cada link, partir do subtotal de cada receita. ignorando se for menor que um bilhao"
"0","### a fazer: remover as linhas com um anti_join, para não contaminar a informação do hoover (outgoing, ingoing count)"
"0","matriz <- matriz %>% "
"0","  mutate(p = per_rec_fte * per_fte_des, "
"0","         # ramo = ifelse((round(subtot_rec * p,0)<1000000000),0,round(subtot_rec * p,0))) %>%"
"0","         ramo = round(subtot_rec * p,0)) %>% "
"0","  group_by(nr,nd) %>%                        "
"0","  summarise(p = sum(p),"
"0","            ramo = sum(ramo)) %>%"
"0","  select(nr,nd,p,ramo)"
